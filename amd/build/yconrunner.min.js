define("qtype_yconrunner/yconrunner",["jquery","core/log","qtype_yconrunner/ace_wrapper"],(function($,log,acePromise){return{init:function(params){$(document).ready((function(){var attemptid=params.attemptid;document.querySelectorAll(".que").forEach((function(question){var verifyButton=question.querySelector("button");if(verifyButton&&"Проверить"===verifyButton.textContent.trim()){var checkButton=question.querySelector(".im-controls");checkButton&&(checkButton.style.display="none")}})),fetch(`https://185.4.67.138/contest/api/contests/${params.contestid}/problems/${params.submissionid}/statement`).then((response=>response.text())).then((data=>{log.debug("Received problem statement:",data),$("#question-text").html(data)})).catch((error=>log.error("Ошибка при получении описания проблемы",error))),acePromise.then((function(ace){log.debug("ACE loaded successfully");var editor=ace.edit("editor");editor.setTheme("ace/theme/monokai-light"),editor.session.setMode("ace/mode/python"),editor.setOptions({fontSize:"18px"});var initialCode=$("#answer-field").val();function sendRequest(formData,language,contestid,answer){formData.append("compiler","python"===language?"python3":"cpp"===language?"gcc_cpp20":"java"===language?"javac":"mcs"),formData.append("problem",params.submissionid);const myHeaders=new Headers;myHeaders.append("Authorization","OAuth y0_AgAEA7qkKGeUAAv6MwAAAAEIAX7dAABWL6qZvrJOUJvQhMBpgC27VCKHrg");fetch(`https://185.4.67.138/contest/api/contests/${contestid}/submissions`,{method:"POST",headers:myHeaders,body:formData,redirect:"follow"}).then((response=>response.json())).then((result=>{log.debug(result);let verdict=result.verdict||("OK"===result.status?"OK":"Error");!function(verdict){let key=`yconrunner_verdicts_${attemptid}`,verdicts=JSON.parse(localStorage.getItem(key))||[];verdicts.unshift(verdict),verdicts.length>3&&verdicts.pop();localStorage.setItem(key,JSON.stringify(verdicts)),loadVerdictHistory()}(verdict),$.ajax({url:M.cfg.wwwroot+"/question/type/yconrunner/grade_response.php",method:"POST",contentType:"application/json",data:JSON.stringify({result:"OK"===verdict?1:0,attemptid:attemptid,verdict:verdict}),success:function(response){log.debug("Оценка успешно сохранена",response),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()},error:function(error){log.error("Ошибка при сохранении оценки:",error),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()}})})).catch((error=>{log.debug(error),$("#result-message").text("Произошла ошибка при отправке решения.").show(),$.ajax({url:M.cfg.wwwroot+"/question/type/yconrunner/grade_response.php",method:"POST",contentType:"application/json",data:JSON.stringify({result:0,attemptid:attemptid}),success:function(response){log.debug("Оценка успешно сохранена",response),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()},error:function(error){log.error("Ошибка при сохранении оценки:",error),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()}})}))}function loadVerdictHistory(){let key=`yconrunner_verdicts_${attemptid}`,verdicts=JSON.parse(localStorage.getItem(key))||[],$historyList=$("#verdict-history");$historyList.empty(),verdicts.forEach((function(verdict){let alertClass="OK"===verdict?"alert-success":"alert-danger",$item=$("<li>").addClass(`list-group-item list-group-item-${alertClass}`).text(verdict);$historyList.append($item)}))}initialCode&&editor.setValue(initialCode,-1),editor.getSession().on("change",(function(){var code=editor.getValue();$("#answer-field").val(code)})),loadVerdictHistory(),window.onbeforeunload=function(e){return"Вы уверены, что хотите покинуть страницу? Несохраненные изменения будут потеряны."},$("#language-select").change((function(){switch($(this).val()){case"python":editor.session.setMode("ace/mode/python");break;case"cpp":editor.session.setMode("ace/mode/c_cpp");break;case"java":editor.session.setMode("ace/mode/java");break;case"csharp":editor.session.setMode("ace/mode/csharp")}})),$("#file-upload").after('<button type="button" id="remove-file" class="btn btn-danger ml-2">Удалить файл</button>'),$("#remove-file").click((function(){$("#file-upload").val(null),window.onbeforeunload=null})),$("#submit-button").click((function(){window.onbeforeunload=null;let extension,commentPrefix,answer=editor.getValue(),language=$("#language-select").val();switch(language){case"python":extension=".py",commentPrefix="#";break;case"cpp":case"java":case"csharp":extension="cpp"===language?".cpp":"java"===language?".java":".cs",commentPrefix="//"}let randomComment=`${commentPrefix} Random number: ${Math.floor(1e6*Math.random())}\n`;answer=randomComment+answer;let contestid=params.contestid,fileInput=$("#file-upload")[0],formData=new FormData;if(fileInput.files.length>0){let file=fileInput.files[0],reader=new FileReader;reader.onload=function(e){let content=e.target.result,modifiedContent=randomComment+content;formData.append("file",new Blob([modifiedContent],{type:"text/plain"}),"main"+extension),sendRequest(formData,language,contestid,answer)},reader.readAsText(file)}else formData.append("code",answer),formData.append("extension",extension),sendRequest(formData,language,contestid,answer)}))}))}))}}}));

//# sourceMappingURL=yconrunner.min.js.map