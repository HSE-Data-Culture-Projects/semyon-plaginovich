define("qtype_yconrunner/yconrunner",["jquery","core/log","qtype_yconrunner/ace_wrapper"],(function($,log,acePromise){return{init:function(params){$(document).ready((function(){document.querySelectorAll(".que").forEach((function(question){var verifyButton=question.querySelector("button");if(verifyButton&&"Проверить"===verifyButton.textContent.trim()){var checkButton=question.querySelector(".im-controls");checkButton&&(checkButton.style.display="none")}})),fetch(`http://localhost:3000/api/contests/${params.contestid}/problems/${params.submissionid}/statement`).then((response=>response.text())).then((data=>{log.debug("Received problem statement:",data),$("#question-text").html(data)})).catch((error=>log.error("Ошибка при получении описания проблемы",error))),acePromise.then((function(ace){log.debug("ACE loaded successfully");var editor=ace.edit("editor");function sendRequest(formData,language,contestid){formData.append("compiler","python"===language?"python3":"cpp"===language?"gcc_cpp20":"java"===language?"javac":"mcs"),formData.append("problem","A");fetch(`http://localhost:3000/api/contests/${contestid}/submissions`,{method:"POST",headers:{},body:formData,redirect:"follow"}).then((response=>response.json())).then((result=>{log.debug(result);let verdict=result.verdict;$("#result-message").text(verdict).show(),$.ajax({url:M.cfg.wwwroot+"/question/type/yconrunner/grade_response.php",method:"POST",contentType:"application/json",data:JSON.stringify({result:"OK"===verdict?1:0,attemptid:params.attemptid}),success:function(response){log.debug("Оценка успешно сохранена",response),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()},error:function(error){log.error("Ошибка при сохранении оценки:",error),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()}})})).catch((error=>{log.debug(error),$("#result-message").text("Произошла ошибка при отправке решения.").show(),$.ajax({url:M.cfg.wwwroot+"/question/type/yconrunner/grade_response.php",method:"POST",contentType:"application/json",data:JSON.stringify({result:0,attemptid:params.attemptid}),success:function(response){log.debug("Оценка успешно сохранена",response),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()},error:function(error){log.error("Ошибка при сохранении оценки:",error),$("#file-upload").val(null),document.getElementById("responseform")&&M&&M.core_formchangechecker&&M.core_formchangechecker.set_form_submitted(),window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),window.location.reload()}})}))}editor.setTheme("ace/theme/monokai"),editor.session.setMode("ace/mode/python"),editor.setOptions({fontSize:"18px"}),editor.$blockScrolling=1/0,window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0),$("#language-select").change((function(){switch($(this).val()){case"python":editor.session.setMode("ace/mode/python");break;case"cpp":editor.session.setMode("ace/mode/c_cpp");break;case"java":editor.session.setMode("ace/mode/java");break;case"csharp":editor.session.setMode("ace/mode/csharp")}})),$("#file-upload").after('<button type="button" id="remove-file" class="btn btn-danger ml-2">Удалить файл</button>'),$("#remove-file").click((function(){$("#file-upload").val(null),window.onbeforeunload=null})),$("#submit-button").click((function(){window.onbeforeunload=null,window.addEventListener("beforeunload",(function(e){e.stopImmediatePropagation()}),!0);let extension,commentPrefix,answer=editor.getValue(),language=$("#language-select").val();switch(language){case"python":extension=".py",commentPrefix="#";break;case"cpp":extension=".cpp",commentPrefix="//";break;case"java":extension=".java",commentPrefix="//";break;case"csharp":extension=".cs",commentPrefix="//"}let randomComment=`${commentPrefix} Random number: ${Math.floor(1e6*Math.random())}\n`;answer=randomComment+answer;let contestid=params.contestid,fileInput=$("#file-upload")[0],formData=new FormData;if(fileInput.files.length>0){let file=fileInput.files[0],reader=new FileReader;reader.onload=function(e){let content=e.target.result,modifiedContent=randomComment+content;formData.append("file",new Blob([modifiedContent],{type:"text/plain"}),"main"+extension),sendRequest(formData,language,contestid)},reader.readAsText(file)}else formData.append("code",answer),formData.append("extension",extension),sendRequest(formData,language,contestid)}))})).catch((function(error){log.error("Failed to load ACE:",error)}))}))}}}));

//# sourceMappingURL=yconrunner.min.js.map